"use strict";function shoppingCar(a){var j=a.ele,n=document.createElement("div");j.appendChild(n),n.className="gwc_hed",n.innerHTML='<input type="checkbox" class="checkall">\n                        <span>全选</span>\n                        <span>商品</span>\n                        <span>单价(元)</span>\n                        <span>数量</span>\n                        <span>小计(元)</span>\n                        <span>操作</span>';var e=document.createElement("div");j.appendChild(e),e.className="gwc_dianpu",e.innerHTML="<span>店铺:</span>\n                        <span>百洋健康跨境自营店</span>\n                        <div>\n                        <span>免运费</span>\n                        <span>满59免运费</span>\n                        </div>";var x=document.createElement("ul");j.appendChild(x),x.className="goodslist";var b=document.createElement("div");j.appendChild(b),b.className="gwc_allmey",b.innerHTML='<span class="allmey">0.00</span><span>商品总价:</span> ';var C=document.createElement("div");j.appendChild(C),C.className="gwc_footer",C.innerHTML='<span class="delall">全删</span>\n                            <span class="sure">确认结算</span>\n                            <span>元</span>\n                            <span class="allmoney">0.00</span>\n                            <span>商品总价（不含运费、税费）</span>';var s=getcookie("username");!function N(){ajax({type:"get",url:"../api/shoppingcar/car.php",data:{cookie:s},succeed:function(a){n(a)}});function n(a){var n=JSON.parse(a),e="";e=n.obj.length?n.obj.map(function(a){return'<li data-id="'+a.id+'">\n                    <input type="checkbox" class="check">\n                    <img src="'+a.img+'" alt="" class="gwc_imgs">\n                    <span class="text">\n                    <span> <span>海外购</span> '+a.name+'</span>\n                   </br>\n                    <span>\n                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/05890672784766467_60.gif" alt="">\n                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/05890672577896183_60.gif" alt="">\n                    <img src="https://b2cstatic.baiyangwang.com/shop/contracticon/jswl_60.gif" alt="">\n                    </span>\n                    </span>\n                    <span class="money">￥'+a.price+'</span>\n                    <div class="gwcnum" data-kucun="'+a.sum+'">\n                        <span class="btnjian">-</span>\n                        <input type="text" class="num" value="'+a.num+'">\n                        <span class="btnjia">+</span>\n                    </div>\n                    <span class="moneyall">'+(a.price*a.num).toFixed(2)+'</span>\n                    <span class="scj">移入收藏夹</span>\n                    <span class="del">删除</span>\n            </li>'}).join(""):'<div class="no-gwc"><img src="../images/nogwc.jpg" alt=""></div>',x.innerHTML=e;for(var t=j.getElementsByClassName("num"),c=j.getElementsByClassName("btnjia"),i=j.getElementsByClassName("btnjian"),l=j.getElementsByClassName("money"),p=j.getElementsByClassName("moneyall"),s=function(s){c[s].onclick=function(){var a=1*c[s].parentNode.dataset.kucun;t[s].value<a&&t[s].value++;var n=l[s].innerHTML.slice(1);p[s].innerHTML=(n*t[s].value).toFixed(2);var e=c[s].parentNode.parentNode.dataset.id;ajax({type:"get",url:"../api/shoppingcar/jiajian.php",data:{id:e,num:t[s].value},succeed:function(){f()}})},i[s].onclick=function(){1<t[s].value&&t[s].value--;var a=l[s].innerHTML.slice(1);p[s].innerHTML=(a*t[s].value).toFixed(2);var n=i[s].parentNode.parentNode.dataset.id;ajax({type:"get",url:"../api/shoppingcar/jiajian.php",data:{id:n,num:t[s].value},succeed:function(){f()}})}},d=0;d<c.length;d++)s(d);for(var o=j.getElementsByClassName("check"),r=j.getElementsByClassName("checkall")[0],u=[],m=function(t){o[t].onclick=function(){for(var a=0,n=0;n<o.length;n++)o[n].checked&&a++,a==o.length&&0!=a?r.checked=!0:r.checked=!1;var e=o[t].parentNode.dataset.id;if(o[t].checked)-1==u.indexOf(e)&&u.push(e);else{var s=u.indexOf(e);u.splice(s,1)}f(),h()}},d=0;d<o.length;d++)m(d);function g(){if(r.checked=!0,r.checked)for(var a=0;a<o.length;a++){o[a].checked=!0;var n=o[a].parentNode.dataset.id;o[a].checked&&-1==u.indexOf(n)&&u.push(n)}else for(var e=0;e<o.length;e++)o[e].checked=!1,u=[];f()}function h(){for(var a=0,n=0;n<o.length;n++)o[n].checked&&a++;0<a?$(".sure").css("background","#EF3C79"):$(".sure").css("background","#aaa")}g(),r.onclick=function(){if(r.checked)for(var a=0;a<o.length;a++){o[a].checked=!0;var n=o[a].parentNode.dataset.id;o[a].checked&&-1==u.indexOf(n)&&u.push(n)}else for(var e=0;e<o.length;e++)o[e].checked=!1,u=[];f(),h()},h(),x.onclick=function(a){if("del"==a.target.className){var n=a.target.parentNode.dataset.id;ajax({type:"get",url:"../api/shoppingcar/del.php",data:{id:n},succeed:function(){N(),r.checked=!1}});var e=u.indexOf(a.target.parentNode.dataset.id);u.splice(e,1),f()}};var v=C.getElementsByClassName("delall")[0];function f(){C.getElementsByClassName("allnum")[0];for(var a=C.getElementsByClassName("allmoney")[0],n=b.getElementsByClassName("allmey")[0],e=0,s=0;s<o.length;s++)o[s].checked&&(e+=1*o[s].parentNode.children[5].innerHTML);a.innerHTML=e.toFixed(2),n.innerHTML=e.toFixed(2)}v.onclick=function(){var a=JSON.stringify(u);ajax({type:"get",url:"../api/shoppingcar/delall.php",data:{idarr:a},succeed:function(){u=[],r.checked=!1,N()}})};var k=getcookie("username");function y(){$.ajax({type:"get",url:"../api/shoppingcar/car.php",data:{cookie:k},dataType:"json",success:function(a){$(".numcar").html(a.obj.length);var n=0,e=a.obj.map(function(a){return n+=a.num*a.price*1,'<li data-id="'+a.id+'">\n                 <div>\n                     <img src="'+a.img+'" alt="">\n                 </div>\n                 <p>'+a.name+"</p>\n                 <p><span>¥"+a.price+"</span>×<span>"+a.num+'</span></p>\n                 <p class="headdel">删除</p>\n             </li>'}).join("");$(".car-list").html(e),$(".headnumall").html(a.obj.length),$(".headmeyall").html("￥"+n.toFixed(2)),$(".car-foot div").click(function(){window.open("../html/gwc.html")}),$(".headdel").click(function(){var a=$(this.parentNode).attr("data-id");console.log(a),$.ajax({type:"get",url:"../api/shoppingcar/del.php",data:{id:a},success:function(a){y()}})})}})}$.ajax({type:"get",url:"../api/footprint/foot.php",data:{cookie:k},dataType:"json",success:function(a){var n=a.map(function(a){return'<div><img src="'+a.img+'" alt=""></div>'}).join("");$(".my-zuji-list").html(n)}}),y()}}()}